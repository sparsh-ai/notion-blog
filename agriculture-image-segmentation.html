<!DOCTYPE html>
<html lang="en">

<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-5F9Y9HC95G"></script>
      <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "G-5F9Y9HC95G");
      </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="Agricultural Image Segmentation">
    <meta property="og:type" content="blog">
  <title>Agricultural Image Segmentation</title>
<link rel="icon" type="image/png" href="./favicon.png"/>
  <!-- Favicon -->
    <link rel="shortcut icon" target="_blank" href="⚡">
    <link rel="stylesheet" type="text/css" target="_blank" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    target="_blank" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" target="_blank" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" target="_blank" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" target="_blank" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index">
      <div class="Navbar__Btn"><span>⚡</span> <span>Home</span></div>
    </a>
                                                                                                                                                                                                            <span class="Navbar__Delim">&centerdot;</span>
    <a href="apps">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://super.so/icon/dark/droplet.svg"></span> <span>Apps</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="jupyter-notebooks">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://super.so/icon/dark/book.svg"></span> <span>Notebooks</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="about">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://super.so/icon/dark/send.svg"></span> <span>About</span></div>
    </a>
                                  </nav>
  <header class="Header">
          <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <h1 class="Header__Title">Agricultural Image Segmentation</h1>
            <div class="DateTagBar">
                <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, Jan 6, 2021</span>
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
            <a target="_blank" href="tag/Image segmentation">Image segmentation</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a target="_blank" href="tag/Short project">Short project</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/46194e3f8ac847928d5d8c4649f5b186" class="PageRoot"><div id="https://www.notion.so/bb9b0180680b4cf4b3a91a82bca9fe7e" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe1316d22-f54f-4af7-bc96-acd60e23cddf%2FUntitled.png?width=949&amp;table=block&amp;id=bb9b0180-680b-4cf4-b3a9-1a82bca9fe7e"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe1316d22-f54f-4af7-bc96-acd60e23cddf%2FUntitled.png?width=949&amp;table=block&amp;id=bb9b0180-680b-4cf4-b3a9-1a82bca9fe7e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h1 id="https://www.notion.so/4ea43e73aa9b4fd880f9832917f6ed71" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" target="_blank" href="#https://www.notion.so/4ea43e73aa9b4fd880f9832917f6ed71"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Data</span></span></h1><div id="https://www.notion.so/dfb6b775f53045c2bec4b4987fa86934" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">1 image with 1800 x 1135 resolution and 60 channels</span></span></p></div><div id="https://www.notion.so/c25e889c52ba4e23b944faaaa4fefaec" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F20ded986-ab09-47a0-86ab-8f334099fe96%2FUntitled.png?width=1117&amp;table=block&amp;id=c25e889c-52ba-4e23-b944-faaaa4fefaec"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F20ded986-ab09-47a0-86ab-8f334099fe96%2FUntitled.png?width=1117&amp;table=block&amp;id=c25e889c-52ba-4e23-b944-faaaa4fefaec" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/cef11feeeb804788997201505b74efed" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">There are 60 bands given by images.tif. The labels data given by labels.tif. There are 8 labels ranging from 1 to 8. 0 value in the label image means no data label available for that pixel. So, it requires a loss function that ignores nodata label (0).</span></span></p></div><div id="https://www.notion.so/a172bc248da94735bedbca1a70f73804" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Every Month 5 bands images were shot from agricultural land for 12 months. So, 5 bands * 12 = 60 bands. The 8 labels mean, 8 types of cropland. There is an assumption that the spectral signal of each crop type varies with bands and months.</span></span></p></div><div id="https://www.notion.so/630fe224abc54b61ad4ffa73f2976d2f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The goal of semantic segmentation is to produce a map of croplands. So, the output will be the same size of labels.tif, with all 0 (no labels) pixels classified into one of 8 classes.</span></span></p></div><div id="https://www.notion.so/0bad62c7b92142728921ddc54e976272" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0df09da3-a40c-42f8-8436-66cd01f0f9ba%2FUntitled.png?width=943&amp;table=block&amp;id=0bad62c7-b921-4272-8921-ddc54e976272"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0df09da3-a40c-42f8-8436-66cd01f0f9ba%2FUntitled.png?width=943&amp;table=block&amp;id=0bad62c7-b921-4272-8921-ddc54e976272" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/ba51114982fd4a7bb69ec81b43fe61ee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Labels: 1 → Crop A, 2 → Crop B, 3 → Crop C, 4 → Crop D, 6 → Crop E, 7 → Crop F, 8 → Crop G</span></span></p></div><div id="https://www.notion.so/cb9d0ed69ca44b0e96009b1fb923f1af" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Sample images required for training and validation can be generated by patching with a sliding window. The size of the patches depends on the model to be applied. Input is a whole 60 bands image. If the model does not support the input of 60 bands image, it is reduced into 3 bands by PCA.</span></span></p></div><h1 id="https://www.notion.so/3d31384b0eae4672bcaceed6cd81926f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" target="_blank" href="#https://www.notion.so/3d31384b0eae4672bcaceed6cd81926f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Bag of tricks</span></span></h1><ol class="NumberedListWrapper"><li id="https://www.notion.so/0a81c284ed284cffab86231c68b94197" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Adaptive histogram equalization [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" target="_blank" href="https://towardsdatascience.com/histogram-equalization-5d1013626e64">ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/ce4f9953ceb94815a82debdbea9d608c" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Image Augmentation with </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" target="_blank" href="https://github.com/albumentations-team/albumentations">Albumentations</a></span></span></li><li id="https://www.notion.so/2f5e2409129f4d31995b66a310ab7bb2" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Normalized 3d numpy array - overall or channel-wise</span></span></li><li id="https://www.notion.so/0fbac6d9ce2148558b4c482b88e72659" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">Label balancing - how? - sampler</span></span></li><li id="https://www.notion.so/d73af63828254a909380a55ede1240f4" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">Try Fine-grained U-net (FG-Unet) architecture</span></span></li><li id="https://www.notion.so/8c8d879fd46946bc9c37af20270b3d18" class="NumberedList" value="6"><span class="SemanticStringArray"><span class="SemanticString">Add sobel edge detection logic in loss function</span></span></li><li id="https://www.notion.so/7d9c07a37f4746eab5517165479590a7" class="NumberedList" value="7"><span class="SemanticStringArray"><span class="SemanticString">Try WDL instead of WBCE [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" target="_blank" href="https://github.com/killthekitten/kaggle-carvana-2017/blob/master/losses.py">Ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/8abf21b84f844345861d365f81686a32" class="NumberedList" value="8"><span class="SemanticStringArray"><span class="SemanticString">How to add pixel weighting component [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" target="_blank" href="https://github.com/jaidevd/jaidevd.github.io/blob/source/blog/posts/code/weighted_loss_unet.py">Ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/6de0a3eead764d24a261f890ea08253c" class="NumberedList" value="9"><span class="SemanticStringArray"><span class="SemanticString">RGB Weight initialization scheme? [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" target="_blank" href="https://github.com/olgaliak/segmentation-unet-maskrcnn/blob/master/unet/model.py">Ref</a></span><span class="SemanticString">] [</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" target="_blank" href="https://arxiv.org/abs/1801.05746">Ref</a></span><span class="SemanticString">]</span></span></li><li id="https://www.notion.so/ccedd82e5ce24dde870f66398ba7af57" class="NumberedList" value="10"><span class="SemanticStringArray"><span class="SemanticString">Baseline: Vanilla Deep UNet</span></span></li><li id="https://www.notion.so/1e57ae971d1d42a29465fecbdd1e14dd" class="NumberedList" value="11"><span class="SemanticStringArray"><span class="SemanticString">+ Residual connection</span></span></li><li id="https://www.notion.so/6d76b293464141a287ed5c41e8cac34b" class="NumberedList" value="12"><span class="SemanticStringArray"><span class="SemanticString">+ Atrous convolutions</span></span></li><li id="https://www.notion.so/388e3a20135e4d79a6f66ca6638ca035" class="NumberedList" value="13"><span class="SemanticStringArray"><span class="SemanticString">+ Pyramid scene parse pooling</span></span></li><li id="https://www.notion.so/35abe42527db4983bebd6808ef7d46b0" class="NumberedList" value="14"><span class="SemanticStringArray"><span class="SemanticString">+ Multitask inference</span></span></li><li id="https://www.notion.so/4713370010c14e6fa253f9c8f1d26add" class="NumberedList" value="15"><span class="SemanticStringArray"><span class="SemanticString">+ CRF post processing</span></span></li><li id="https://www.notion.so/7434cbee53b34873b4c9732ab1e2b436" class="NumberedList" value="16"><span class="SemanticStringArray"><span class="SemanticString">+ Boundary sharpening</span></span></li><li id="https://www.notion.so/11c2b835f46c470d8d1528eb796dd236" class="NumberedList" value="17"><span class="SemanticStringArray"><span class="SemanticString">+ Fine grained Unet</span></span></li><li id="https://www.notion.so/744818131d884df6a9627c2e90620b06" class="NumberedList" value="18"><span class="SemanticStringArray"><span class="SemanticString">+ Late temporal fusion</span></span></li><li id="https://www.notion.so/0480fa3cfc484eef9612d494b2c54c5f" class="NumberedList" value="19"><span class="SemanticStringArray"><span class="SemanticString">+ Percentile normalization fitting</span></span></li><li id="https://www.notion.so/16ddc197d1524b4896a2ba527b0756f1" class="NumberedList" value="20"><span class="SemanticStringArray"><span class="SemanticString">+ Patch normalization transform</span></span></li><li id="https://www.notion.so/3a34322055ce4da78cfa199eaba470a8" class="NumberedList" value="21"><span class="SemanticStringArray"><span class="SemanticString">+ Lower threshold (90%)</span></span></li><li id="https://www.notion.so/a5f3767b7d6c4b84bc897eb3d3c816ed" class="NumberedList" value="22"><span class="SemanticStringArray"><span class="SemanticString">+ On fly patch generation</span></span></li><li id="https://www.notion.so/287b336ef7bc4f12b69a1ca2a22f1654" class="NumberedList" value="23"><span class="SemanticStringArray"><span class="SemanticString">+ Patch stitch averaging</span></span></li></ol><h3 id="https://www.notion.so/01472d1ebe47435d81ffa73402e8534b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" target="_blank" href="#https://www.notion.so/01472d1ebe47435d81ffa73402e8534b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Augmentation scheme</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/80e7529df3e243418d7c125f190c9e97" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Random rotation by 90 degrees</span></span></li><li id="https://www.notion.so/5775c3baee414ea18632f1e9fe28d732" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Horizontal and Vertical flip</span></span></li><li id="https://www.notion.so/c20f022b0c1346c1b7f0d9b96384d391" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Heavy Geometric Transformations</span></span></li><li id="https://www.notion.so/375109b0df08437a84f27b6886bb2db1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Random HSV</span></span></li><li id="https://www.notion.so/12ea07a1c73b4e47acab15e213338507" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Loss-less augmentation</span></span></li><li id="https://www.notion.so/f0ff0dd8e9554c94bf7bdab37507d550" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Channel shuffling</span></span></li><li id="https://www.notion.so/83e5149cb84141aba489b2503aaef5ee" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Data augmentation based on class frequency</span></span></li><li id="https://www.notion.so/ce7ec531f69244c89d1b972a172fe663" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Apply gaussian noise</span></span></li><li id="https://www.notion.so/00930e096db24b69b5aeaf08d5133f2a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Scale by a random factor from 0.8 to 1.2</span></span></li><li id="https://www.notion.so/1592f0a608814eeeb404fd84569873e7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Brighness changing</span></span></li></ul><h3 id="https://www.notion.so/d5ecbd9041da4ef29a1f427326da4b5d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" target="_blank" href="#https://www.notion.so/d5ecbd9041da4ef29a1f427326da4b5d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Loss functions</span></span></h3><details id="https://www.notion.so/bc0f0a07463f4662b9ca7d4e63b9cb31" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">Ref images</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/5712f506e3b34d3cbd9b846e59012a14" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F657ac98e-a12d-45a7-87c7-64dd79fc508f%2FUntitled.png?width=984&amp;table=block&amp;id=5712f506-e3b3-4d3c-bd9b-846e59012a14"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F657ac98e-a12d-45a7-87c7-64dd79fc508f%2FUntitled.png?width=984&amp;table=block&amp;id=5712f506-e3b3-4d3c-bd9b-846e59012a14" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/abacebfd264c4cb69c1fb4fc4ca06c9c" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9801a21c-6451-4e53-8fa3-e0b050a99eee%2FUntitled.png?width=984&amp;table=block&amp;id=abacebfd-264c-4cb6-9c1f-b4fc4ca06c9c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9801a21c-6451-4e53-8fa3-e0b050a99eee%2FUntitled.png?width=984&amp;table=block&amp;id=abacebfd-264c-4cb6-9c1f-b4fc4ca06c9c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c0bdc031475d43598fafec944badd907" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9536f18a-ad44-443a-b651-f2fe381a9b0c%2FUntitled.png?width=1507&amp;table=block&amp;id=c0bdc031-475d-4359-8faf-ec944badd907"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9536f18a-ad44-443a-b651-f2fe381a9b0c%2FUntitled.png?width=1507&amp;table=block&amp;id=c0bdc031-475d-4359-8faf-ec944badd907" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></details><details id="https://www.notion.so/be0a78508f6c4c7b9b94fe0e76dc8924" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">Code snippets</span></span></summary><div class="Toggle__Content"><pre id="https://www.notion.so/a84f231ba4a8438bbc31e5bb15078a9d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">soft_dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> epsilon<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token triple-quoted-string string">''' 
    Soft dice loss calculation for arbitrary batch size, number of classes, and number of spatial dimensions.
    Assumes the `channels_last` format.
  
    # Arguments
        y_true: b x X x Y( x Z...) x c One hot encoding of ground truth
        y_pred: b x X x Y( x Z...) x c Network output, must sum to 1 over c channel (such as after softmax) 
        epsilon: Used for numerical stability to avoid divide by zero errors
    
    # References
        V-Net: Fully Convolutional Neural Networks for Volumetric Medical Image Segmentation 
        https://arxiv.org/abs/1606.04797
        More details on Dice loss formulation 
        https://mediatum.ub.tum.de/doc/1395260/1395260.pdf (page 72)
        
        Adapted from https://github.com/Lasagne/Recipes/issues/99#issuecomment-347775022
    '''</span>
    
    <span class="token comment"># skip the batch and class axis for calculating Dice score</span>
    axes <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y_pred<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    numerator <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_pred <span class="token operator">*</span> y_true<span class="token punctuation">,</span> axes<span class="token punctuation">)</span>
    denominator <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_pred<span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_true<span class="token punctuation">)</span><span class="token punctuation">,</span> axes<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>numerator <span class="token operator">/</span> <span class="token punctuation">(</span>denominator <span class="token operator">+</span> epsilon<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># average over classes and batch</span></span></span></span></code></pre><pre id="https://www.notion.so/4e6032204297447f902d2b0723d5f67d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">jaccard_coef</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    intersection <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">*</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_ <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">+</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    jac <span class="token operator">=</span> <span class="token punctuation">(</span>intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>sum_ <span class="token operator">-</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">return</span> K<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>jac<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
  numerator <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true <span class="token operator">*</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  denominator <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true <span class="token operator">+</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">-</span> numerator <span class="token operator">/</span> denominator


<span class="token keyword">def</span> <span class="token function">focal_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    output <span class="token operator">/=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    eps <span class="token operator">=</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span>
    output <span class="token operator">=</span> K<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>output<span class="token punctuation">,</span> eps<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span> <span class="token operator">-</span> eps<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">-</span>K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>K<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token operator">-</span> output<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span> <span class="token operator">*</span> target <span class="token operator">*</span> K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span></code></pre><pre id="https://www.notion.so/73f2fafbaa514dbdb8f85534e240caca" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">weighted_categorical_crossentropy</span><span class="token punctuation">(</span>weights<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    A weighted version of keras.objectives.categorical_crossentropy
    
    Variables:
        weights: numpy array of shape (C,) where C is the number of classes
    
    Usage:
        weights = np.array([0.5,2,10]) # Class one at 0.5, class 2 twice the normal weights, class 3 10x.
        loss = weighted_categorical_crossentropy(weights)
        model.compile(loss=loss,optimizer='adam')
    """</span>
    
    weights <span class="token operator">=</span> K<span class="token punctuation">.</span>variable<span class="token punctuation">(</span>weights<span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># scale predictions so that the class probas of each sample sum to 1</span>
        y_pred <span class="token operator">/=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment"># clip to prevent NaN's and Inf's</span>
        y_pred <span class="token operator">=</span> K<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># calc</span>
        loss <span class="token operator">=</span> y_true <span class="token operator">*</span> K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>y_pred<span class="token punctuation">)</span> <span class="token operator">*</span> weights
        loss <span class="token operator">=</span> <span class="token operator">-</span>K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> loss
    
    <span class="token keyword">return</span> loss</span></span></span></code></pre><pre id="https://www.notion.so/33d241be7ff343c09ffcf593f7247535" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">dice_coeff</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    smooth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>
    <span class="token comment"># Flatten</span>
    y_true_f <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y_pred_f <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    intersection <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true_f <span class="token operator">*</span> y_pred_f<span class="token punctuation">)</span>
    score <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_true_f<span class="token punctuation">)</span> <span class="token operator">+</span> tf<span class="token punctuation">.</span>reduce_sum<span class="token punctuation">(</span>y_pred_f<span class="token punctuation">)</span> <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">return</span> score

<span class="token keyword">def</span> <span class="token function">dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    loss <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> dice_coeff<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    <span class="token keyword">return</span> loss

<span class="token keyword">def</span> <span class="token function">bce_dice_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    loss <span class="token operator">=</span> losses<span class="token punctuation">.</span>binary_crossentropy<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span> <span class="token operator">+</span> dice_loss<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    <span class="token keyword">return</span> loss</span></span></span></code></pre><pre id="https://www.notion.so/dfda0d2c846448079576bc6202cf2d95" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>_EPSILON <span class="token operator">=</span> K<span class="token punctuation">.</span>epsilon<span class="token punctuation">(</span><span class="token punctuation">)</span>
nb_class<span class="token operator">=</span><span class="token number">9</span> <span class="token comment"># number of objects plus the background</span>
<span class="token keyword">def</span> <span class="token function">custom_loss</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
  y_pred <span class="token operator">=</span> K<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> _EPSILON<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">-</span>_EPSILON<span class="token punctuation">)</span>

  <span class="token comment"># find predictions</span>
  pred<span class="token operator">=</span>K<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment"># find missing annotations per class</span>
  y_trueAny<span class="token operator">=</span>K<span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token comment">#print "missing annotations",K.eval(y_trueAny)</span>

  backgroundWeights<span class="token operator">=</span><span class="token number">1</span>
  <span class="token keyword">for</span> cls <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>nb_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token comment"># we use repeat to get the same size as other tensors</span>
      y_trueAnyRepeat<span class="token operator">=</span>K<span class="token punctuation">.</span>repeat_elements<span class="token punctuation">(</span>y_trueAny<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>cls<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token comment">#print "repeat shape",K.eval(K.shape(y_trueAnyRepeat))</span>
      
      <span class="token comment"># check for two conditions</span>
      <span class="token comment"># 1- annotation missing</span>
      <span class="token comment"># 2- prediction is equal to missing class/object</span>
      backgroundWeights<span class="token operator">*=</span>K<span class="token punctuation">.</span>not_equal<span class="token punctuation">(</span>pred<span class="token punctuation">,</span>cls<span class="token punctuation">)</span><span class="token operator">+</span>y_trueAnyRepeat
      <span class="token comment">#print "background weights shape",K.eval(K.shape(backgroundWeights)),K.eval(K.shape(pred))</span>
      <span class="token comment">#print "sum of background weights",cls,K.eval(K.sum(backgroundWeig0.191179hts))</span>

  <span class="token comment"># loss for background</span>
  loss<span class="token operator">=</span>backgroundWeights<span class="token operator">*</span>y_true<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>y_pred<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> cls <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>nb_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
      loss<span class="token operator">+=</span>y_true<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>cls<span class="token punctuation">]</span><span class="token operator">*</span>K<span class="token punctuation">.</span>log<span class="token punctuation">(</span>y_pred<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>cls<span class="token punctuation">]</span><span class="token punctuation">)</span>
      
  <span class="token keyword">return</span> <span class="token operator">-</span>loss</span></span></span></code></pre><pre id="https://www.notion.so/b9281ea5a3834eae982cd22818345a2d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">def</span> <span class="token function">dice_coef_rb</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> smooth<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_true <span class="token operator">=</span> K<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> <span class="token string">'int32'</span><span class="token punctuation">)</span>
    y_true <span class="token operator">=</span> K<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>y_true<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    y_pred <span class="token operator">=</span> y_pred<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    intersection <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">*</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_ <span class="token operator">=</span> K<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y_true <span class="token operator">+</span> y_pred<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> K<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">*</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>sum_ <span class="token operator">+</span> smooth<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">dice_coef_loss_rb</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">-</span> dice_coef_rb<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span></span></span></span></code></pre></div></details><ol class="NumberedListWrapper"><li id="https://www.notion.so/d80bdc53518b487383fec7d887f393da" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Dice loss</span></span></li><li id="https://www.notion.so/00fd056f67f34933886a714caad314c5" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Class weights</span></span></li><li id="https://www.notion.so/cbcc0edd5de448338c6c4952201c7268" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Pixel weighted (weighted boundary loss - </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" target="_blank" href="https://www.kaggle.com/lyakaap/weighing-boundary-pixels-loss-script-by-keras2">code</a></span><span class="SemanticString">)</span></span></li><li id="https://www.notion.so/3b76a18e908b4bdaba99a0bb53be3c8d" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">Combination of BCE, Dice and Focal</span></span></li></ol><h3 id="https://www.notion.so/618637533c2c40c9bcc085bfa84c40f3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" target="_blank" href="#https://www.notion.so/618637533c2c40c9bcc085bfa84c40f3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Hyperparameters</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/c606cc88247843c8afab65736869c6b5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Binary class vs. Multiclass</span></span></li><li id="https://www.notion.so/b07baa73de3d47e0a377a34932bc09f3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Standardisation channel-wise or image-wise</span></span></li><li id="https://www.notion.so/41dd1614dd5a45f7b1c6a9f4e08da6f4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Class weights</span></span></li><li id="https://www.notion.so/302d613fed9844139ecfc49aa3f278b3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Patch-based vs. Stride</span></span></li><li id="https://www.notion.so/b09bb223a7b248039da60c0c351ac4b1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Augmentation</span></span></li><li id="https://www.notion.so/319b51297eea497c8a075f6bd763bb1e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">U-net model architecture</span></span></li><li id="https://www.notion.so/f09ef0664c7e42e18bf17be928e873e6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Loss function</span></span></li></ul><h1 id="https://www.notion.so/775c5114570046878b3cf51d32ccb6f3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" target="_blank" href="#https://www.notion.so/775c5114570046878b3cf51d32ccb6f3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Results and Discussion</span></span></h1><div id="https://www.notion.so/d357f877b1b44e659a8e8aa7480ac717" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4312e869-4afd-4018-955f-e36ece5ae8f6%2FUntitled.png?width=851&amp;table=block&amp;id=d357f877-b1b4-4e65-9a8e-8aa7480ac717"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4312e869-4afd-4018-955f-e36ece5ae8f6%2FUntitled.png?width=851&amp;table=block&amp;id=d357f877-b1b4-4e65-9a8e-8aa7480ac717" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/becec19cb0a443d997330618b45992fd" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc491844a-d08e-43ea-9133-a131ffdc2bfe%2FUntitled.png?width=851&amp;table=block&amp;id=becec19c-b0a4-43d9-9733-0618b45992fd"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc491844a-d08e-43ea-9133-a131ffdc2bfe%2FUntitled.png?width=851&amp;table=block&amp;id=becec19c-b0a4-43d9-9733-0618b45992fd" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/7baad2fb1a65452386b712cb82b35286" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa03315f2-d315-45f7-9f63-0c4db16f161b%2FUntitled.png?width=851&amp;table=block&amp;id=7baad2fb-1a65-4523-86b7-12cb82b35286"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa03315f2-d315-45f7-9f63-0c4db16f161b%2FUntitled.png?width=851&amp;table=block&amp;id=7baad2fb-1a65-4523-86b7-12cb82b35286" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/31d5d706d7264b86901e3fe0089589da" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8278fa73-59f5-4220-baf6-3e4ad28b294f%2FUntitled.png?width=851&amp;table=block&amp;id=31d5d706-d726-4b86-901e-3fe0089589da"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8278fa73-59f5-4220-baf6-3e4ad28b294f%2FUntitled.png?width=851&amp;table=block&amp;id=31d5d706-d726-4b86-901e-3fe0089589da" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/9fb6e2e0f05b48c5842fb4aa68667f2d" class="Image Image--PageWidth"><figure><a target="_blank" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa3e08bad-91f0-4fa8-b009-3b395e44b5ab%2FUntitled.png?width=851&amp;table=block&amp;id=9fb6e2e0-f05b-48c5-842f-b4aa68667f2d"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa3e08bad-91f0-4fa8-b009-3b395e44b5ab%2FUntitled.png?width=851&amp;table=block&amp;id=9fb6e2e0-f05b-48c5-842f-b4aa68667f2d" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></article>  <footer class="Footer">
        <div>&copy; NotionSite 2021</div>
        <div>&centerdot;</div>
        <div>Powered by <a target="_blank" href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>